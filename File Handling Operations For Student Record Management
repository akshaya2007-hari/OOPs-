import java.io.*;
import java.util.*;

public class StudentRecordManagement {

    static final String FILE_NAME = "students.txt";

    // Add new student record
    public static void addStudent(String id, String name, String course) {
        try (FileWriter fw = new FileWriter(FILE_NAME, true);
             BufferedWriter bw = new BufferedWriter(fw);
             PrintWriter out = new PrintWriter(bw)) {
            out.println(id + "," + name + "," + course);
            System.out.println("✅ Student record added successfully!");
        } catch (IOException e) {
            System.out.println("Error while adding record: " + e.getMessage());
        }
    }

    // Display all records
    public static void displayStudents() {
        try (BufferedReader br = new BufferedReader(new FileReader(FILE_NAME))) {
            String line;
            System.out.println("---- Student Records ----");
            while ((line = br.readLine()) != null) {
                String[] data = line.split(",");
                System.out.println("ID: " + data[0] + " | Name: " + data[1] + " | Course: " + data[2]);
            }
        } catch (IOException e) {
            System.out.println("Error while reading records: " + e.getMessage());
        }
    }

    // Update a student record (by ID)
    public static void updateStudent(String id, String newName, String newCourse) {
        File inputFile = new File(FILE_NAME);
        File tempFile = new File("temp.txt");

        try (BufferedReader br = new BufferedReader(new FileReader(inputFile));
             PrintWriter pw = new PrintWriter(new FileWriter(tempFile))) {
            String line;
            boolean updated = false;
            while ((line = br.readLine()) != null) {
                String[] data = line.split(",");
                if (data[0].equals(id)) {
                    pw.println(id + "," + newName + "," + newCourse);
                    updated = true;
                } else {
                    pw.println(line);
                }
            }
            if (updated) {
                System.out.println("✅ Student record updated successfully!");
            } else {
                System.out.println("❌ Student ID not found.");
            }
        } catch (IOException e) {
            System.out.println("Error while updating record: " + e.getMessage());
        }

        // Replace old file with updated file
        inputFile.delete();
        tempFile.renameTo(inputFile);
    }

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        int choice;

        do {
            System.out.println("\n--- Student Record Management System ---");
            System.out.println("1. Add Student");
            System.out.println("2. Display Students");
            System.out.println("3. Update Student");
            System.out.println("4. Exit");
            System.out.print("Enter your choice: ");
            choice = sc.nextInt();

            switch (choice) {
                case 1:
                    System.out.print("Enter ID: ");
                    String id = sc.next();
                    System.out.print("Enter Name: ");
                    String name = sc.next();
                    System.out.print("Enter Course: ");
                    String course = sc.next();
                    addStudent(id, name, course);
                    break;

                case 2:
                    displayStudents();
                    break;

                case 3:
                    System.out.print("Enter ID to update: ");
                    String uid = sc.next();
                    System.out.print("Enter new Name: ");
                    String uname = sc.next();
                    System.out.print("Enter new Course: ");
                    String ucourse = sc.next();
                    updateStudent(uid, uname, ucourse);
                    break;

                case 4:
                    System.out.println("Exiting...");
                    break;

                default:
                    System.out.println("Invalid choice! Try again.");
            }
        } while (choice != 4);

        sc.close();
    }
}
